"""
app.py

A minimal Flask application demonstrating the use of itsdangerous for token
generation and validation.
"""

from itsdangerous import URLSafeTimedSerializer as Serializer

SECRET_KEY = "supersecret"


def create_token(data):
    """
    Generate a time-limited URL-safe token from a given dictionary.

    This function uses `itsdangerous.URLSafeTimedSerializer` to create a
    secure token that includes a timestamp and a signature.

    Args:
        data (dict): A dictionary of data to encode into the token.

    Returns:
        str: A string representing the encoded token. The token will have an
             expiration of 60 seconds.

    Example:
        >>> create_token({"user": "alice"})
        'eyJ1c2VyIjoiYWxpY2UifQ.some_timestamp.some_signature'
    """
    # Works in itsdangerous 2.x
    s = Serializer(SECRET_KEY)
    return s.dumps(data)


def verify_token(token):
    """
    Decode and validate a time-limited URL-safe token.

    Args:
        token (str): The token string to decode.

    Returns:
        dict: The original data encoded in the token if valid.

    Raises:
        itsdangerous.BadSignature: If the token is invalid or has been tampered with.
        itsdangerous.SignatureExpired: If the token has expired (after 60 seconds).

    Example:
        >>> token = create_token({"user": "alice"})
        >>> verify_token(token)
        {'user': 'alice'}
    """
    s = Serializer(SECRET_KEY)
    return s.loads(token, max_age=60)
